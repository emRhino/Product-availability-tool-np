<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Automagiczny walidator dostępności produktów</title>

    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.10/dist/clipboard.min.js"></script>

    <style>
      body {
        font-family: arial;
        /* padding: 50px; */
        font-size: 14px;
        margin: 0;
        padding: 0;
      }

      .result-table {
        width: 100%;
        margin-bottom: 25px;
        border-collapse: collapse;
      }

      .result-table td,
      .result-table th {
        border: 1px solid rgba(0, 0, 0, 0.07);
        /* border-collapse: collapse; */
        text-align: left;
        padding: 5px;
      }

      h4 {
        margin: 0 0 10px 0;
        padding: 0;
        font-size: 16px;
      }

      label {
        font-size: 14px;
        margin-bottom: 5px;
      }

      .option {
        display: none;
      }

      .result-table img {
        width: 160px;
      }

      h2 {
        font-size: 18px;
        text-align: left;
        margin-bottom: 15px;
        padding-bottom: 5px;
      }

      .group {
        display: flex;
        flex-wrap: no-wrap;
      }

      .group .half {
        padding: 20px;
      }

      .group .left {
        width: 350px;
      }

      .group .right {
        width: calc(100% - 300px);
      }

      header {
        background: rgba(0, 0, 0, 0.07);
        border-top: 1px solid rgba(0, 0, 0, 0.8);
        /* padding: 20px; */
        /* color: white; */
        width: 100%;
        font-size: 16px;
      }

      .total-count-wrapper {
        display: flex;
        justify-content: flex-end;
      }

      #form {
        display: flex;
      }

      #form fieldset {
        border: 0;
        width: 500px;
      }

      .query-submit {
        border: none;
        background: #71ad3d;
        font-size: 14px;
        padding: 10px 20px;
        color: white;
        /* width: 100%; */
        box-sizing: border-box;
        border-radius: 4px;
        box-shadow: 0 2px 0 #3f6121;
        position: relative;
      }

      .query-field,
      select,
      textarea {
        padding: 6px 10px;
        font-size: 14px;
        width: 100%;
        box-sizing: border-box;
        resize: none;
        border: 1px solid rgba(0, 0, 0, 0.13);
        background: white;
        border-radius: 4px;
        /* margin-bottom: 5px; */
      }

      .left-column,
      .right-column {
        margin-right: 10px;
      }

      input:focus,
      textarea:focus {
        outline: none;
        focus: none;
      }

      input#query-submit:active {
        box-shadow: 0 2px 0 #3f6121;
        bottom: -1px;
      }

      .orange {
        background: #ffd700;
      }

      .green {
        background: #8bda2b;
      }

      .total-count {
        /* margin: 20px 0; */
        font-size: 18px;
      }

      #results-failure {
        margin: 0 0 0 20px;
        padding: 0 0 0 20px;
        /* border: 1px solid rgba(0,0,0,.13); */
      }

      #results-failure li {
        padding: 5px;
        /* border-bottom: 1px solid rgba(0,0,0,.13); */
      }

      h1 {
        background: rgba(0, 0, 0, 0.75);
        color: white;
        padding: 10px;
        font-size: 14px;
        font-weight: bold;
        margin: 0;
        text-align: center;
      }

      .current-price {
        font-weight: bold;
        color: red;
      }

      .single-query-row {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
      }

      .field-autocomplete {
        position: relative;
        width: 100%;
      }

      .autocomplete ul {
        margin: 0;
        padding: 0;
        list-style: none;
        padding: 6px 10px;
        background: white;
        border: 1px solid rgba(0, 0, 0, 0.13);
        border-radius: 4px;
        font-size: 14px;
        width: calc(100% - 22px);
        position: absolute;
        display: none;
        z-index: 999;
      }

      .autocomplete ul li {
        margin-bottom: 3px;
      }

      .autocomplete ul li:hover {
        background-color: rgba(0, 0, 0, 0.05);
        cursor: pointer;
      }

      .heading {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
    </style>
  </head>
  <body>
    <h1>
      Automagiczny walidator dostępności produktów
      <small
        style="
          color: rgba(255, 255, 255, 0.65);
          font-size: 12px;
          font-weight: normal;
        "
        >(wersja 2.1 z dn. 06.02.2023)</small
      >
    </h1>
    <header>
      <div class="group">
        <div class="half right">
          <div class="put-file">
            <!-- <button class="reset" onclick="location.reload();">Nowe wyszukiwanie</button> -->
            <form id="form">
              <fieldset class="select">
                <h4>Metoda importu danych</h4>
                <div>
                  <input
                    type="radio"
                    name="opt"
                    id="opt-1"
                    value="list"
                    class="radio-field"
                  />
                  <label for="opt-1">Lista indeksów</label>
                </div>
                <div>
                  <input
                    type="radio"
                    name="opt"
                    id="opt-2"
                    value="file"
                    class="radio-field"
                  />
                  <label for="opt-2">Plik CSV</label>
                </div>
                <div>
                  <input
                    type="radio"
                    name="opt"
                    id="opt-3"
                    value="custom-query"
                    class="radio-field"
                  />
                  <label for="opt-3">Niestandardowe zapytanie</label>
                </div>
              </fieldset>
              <fieldset class="list option">
                <textarea
                  rows="3"
                  cols="5"
                  id="query-field"
                  placeholder="Wklej indexy rozdzielone przecinkami, max 150 sku"
                ></textarea>
                <input
                  type="submit"
                  value="Sprawdź produkty"
                  class="query-submit"
                />
              </fieldset>

              <fieldset class="file option">
                <label for="csv-file">Wczytaj plik CSV</label>
                <input type="file" name="csv-file" id="files" />
              </fieldset>

              <fieldset class="custom-query option">
                <div id="query-builder"></div>

                <input
                  type="button"
                  id="add-query-row"
                  value="Dodaj kryteria wyszukiwania"
                />
                <hr />
                <input
                  type="submit"
                  value="Wyszukaj produkty"
                  class="query-submit"
                />
              </fieldset>
            </form>
          </div>
        </div>
        <div class="half left total-count-wrapper">
          <div class="total-count"></div>
          <div class="op-duration"></div>
        </div>
      </div>
    </header>
    <div class="group">
      <div class="half left">
        <h2>
          Indeksy niedostępne na stronie (<span class="reject-counter">0</span>)
        </h2>
        <ul class="result-table" id="results-failure"></ul>
      </div>

      <div class="half right">
        <div class="heading">
          <h2>
            Indeksy sprawdzone poprawnie (<span class="resolve-counter">0</span
            >)
          </h2>
          <div class="action-buttons">
            <button id="copy-product-ids" disabled>
              Kopiuj indeksy do schowka
            </button>
            <button id="download-excel" disabled>Pobierz Excel</button>
          </div>
        </div>
        <table class="result-table" id="results-success">
          <thead>
            <tr>
              <th>SKU</th>
              <th>Zdjęcie</th>
              <th>Nazwa</th>
              <th>Cena</th>
              <th>Cena bazowa</th>
              <th>Rozmiary</th>
              <th class="orange">Stock</th>
              <th class="green">Sprzedaż</th>
              <th>Dostępność</th>
              <th>Kategoria główna</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <iframe id="txtArea1" style="display: none"></iframe>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- <script src="assets/jquery-csv.min.js"></script>
    <script src="assets/app.js"></script> -->

    <!-- <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script> -->

    <script>
      (RegExp.escape = function (r) {
        return r.replace(/[-\/\\^$*+?.()|[\]{}]/g, "\\$&");
      }),
        function () {
          "use strict";
          var r;
          ((r = "undefined" != typeof jQuery && jQuery ? jQuery : {}).csv = {
            defaults: { separator: ",", delimiter: '"', headers: !0 },
            hooks: {
              castToScalar: function (r, e) {
                if (isNaN(r)) return r;
                if (/\./.test(r)) return parseFloat(r);
                var a = parseInt(r);
                return isNaN(a) ? null : a;
              },
            },
            parsers: {
              parse: function (r, e) {
                var a = e.separator,
                  t = e.delimiter;
                e.state.rowNum || (e.state.rowNum = 1),
                  e.state.colNum || (e.state.colNum = 1);
                var s = [],
                  o = [],
                  n = 0,
                  i = "",
                  l = !1;
                function c() {
                  if (((n = 0), (i = ""), e.start && e.state.rowNum < e.start))
                    return (
                      (o = []), e.state.rowNum++, void (e.state.colNum = 1)
                    );
                  if (void 0 === e.onParseEntry) s.push(o);
                  else {
                    var r = e.onParseEntry(o, e.state);
                    !1 !== r && s.push(r);
                  }
                  (o = []),
                    e.end && e.state.rowNum >= e.end && (l = !0),
                    e.state.rowNum++,
                    (e.state.colNum = 1);
                }
                function u() {
                  if (void 0 === e.onParseValue) o.push(i);
                  else {
                    var r = e.onParseValue(i, e.state);
                    !1 !== r && o.push(r);
                  }
                  (i = ""), (n = 0), e.state.colNum++;
                }
                var f = RegExp.escape(a),
                  d = RegExp.escape(t),
                  m = /(D|S|\r\n|\n|\r|[^DS\r\n]+)/,
                  p = m.source;
                return (
                  (p = (p = p.replace(/S/g, f)).replace(/D/g, d)),
                  (m = new RegExp(p, "gm")),
                  r.replace(m, function (r) {
                    if (!l)
                      switch (n) {
                        case 0:
                          if (r === a) {
                            (i += ""), u();
                            break;
                          }
                          if (r === t) {
                            n = 1;
                            break;
                          }
                          if (/^(\r\n|\n|\r)$/.test(r)) {
                            u(), c();
                            break;
                          }
                          (i += r), (n = 3);
                          break;
                        case 1:
                          if (r === t) {
                            n = 2;
                            break;
                          }
                          (i += r), (n = 1);
                          break;
                        case 2:
                          if (r === t) {
                            (i += r), (n = 1);
                            break;
                          }
                          if (r === a) {
                            u();
                            break;
                          }
                          if (/^(\r\n|\n|\r)$/.test(r)) {
                            u(), c();
                            break;
                          }
                          throw new Error(
                            "CSVDataError: Illegal State [Row:" +
                              e.state.rowNum +
                              "][Col:" +
                              e.state.colNum +
                              "]"
                          );
                        case 3:
                          if (r === a) {
                            u();
                            break;
                          }
                          if (/^(\r\n|\n|\r)$/.test(r)) {
                            u(), c();
                            break;
                          }
                          if (r === t)
                            throw new Error(
                              "CSVDataError: Illegal Quote [Row:" +
                                e.state.rowNum +
                                "][Col:" +
                                e.state.colNum +
                                "]"
                            );
                          throw new Error(
                            "CSVDataError: Illegal Data [Row:" +
                              e.state.rowNum +
                              "][Col:" +
                              e.state.colNum +
                              "]"
                          );
                        default:
                          throw new Error(
                            "CSVDataError: Unknown State [Row:" +
                              e.state.rowNum +
                              "][Col:" +
                              e.state.colNum +
                              "]"
                          );
                      }
                  }),
                  0 !== o.length && (u(), c()),
                  s
                );
              },
              splitLines: function (e, a) {
                if (e) {
                  var t = (a = a || {}).separator || r.csv.defaults.separator,
                    s = a.delimiter || r.csv.defaults.delimiter;
                  (a.state = a.state || {}),
                    a.state.rowNum || (a.state.rowNum = 1);
                  var o = [],
                    n = 0,
                    i = "",
                    l = !1,
                    c = RegExp.escape(t),
                    u = RegExp.escape(s),
                    f = /(D|S|\n|\r|[^DS\r\n]+)/,
                    d = f.source;
                  return (
                    (d = (d = d.replace(/S/g, c)).replace(/D/g, u)),
                    (f = new RegExp(d, "gm")),
                    e.replace(f, function (r) {
                      if (!l)
                        switch (n) {
                          case 0:
                            if (r === t) {
                              (i += r), (n = 0);
                              break;
                            }
                            if (r === s) {
                              (i += r), (n = 1);
                              break;
                            }
                            if ("\n" === r) {
                              m();
                              break;
                            }
                            if (/^\r$/.test(r)) break;
                            (i += r), (n = 3);
                            break;
                          case 1:
                            if (r === s) {
                              (i += r), (n = 2);
                              break;
                            }
                            (i += r), (n = 1);
                            break;
                          case 2:
                            var e = i.substr(i.length - 1);
                            if (r === s && e === s) {
                              (i += r), (n = 1);
                              break;
                            }
                            if (r === t) {
                              (i += r), (n = 0);
                              break;
                            }
                            if ("\n" === r) {
                              m();
                              break;
                            }
                            if ("\r" === r) break;
                            throw new Error(
                              "CSVDataError: Illegal state [Row:" +
                                a.state.rowNum +
                                "]"
                            );
                          case 3:
                            if (r === t) {
                              (i += r), (n = 0);
                              break;
                            }
                            if ("\n" === r) {
                              m();
                              break;
                            }
                            if ("\r" === r) break;
                            if (r === s)
                              throw new Error(
                                "CSVDataError: Illegal quote [Row:" +
                                  a.state.rowNum +
                                  "]"
                              );
                            throw new Error(
                              "CSVDataError: Illegal state [Row:" +
                                a.state.rowNum +
                                "]"
                            );
                          default:
                            throw new Error(
                              "CSVDataError: Unknown state [Row:" +
                                a.state.rowNum +
                                "]"
                            );
                        }
                    }),
                    "" !== i && m(),
                    o
                  );
                }
                function m() {
                  if (((n = 0), a.start && a.state.rowNum < a.start))
                    return (i = ""), void a.state.rowNum++;
                  if (void 0 === a.onParseEntry) o.push(i);
                  else {
                    var r = a.onParseEntry(i, a.state);
                    !1 !== r && o.push(r);
                  }
                  (i = ""),
                    a.end && a.state.rowNum >= a.end && (l = !0),
                    a.state.rowNum++;
                }
              },
              parseEntry: function (r, e) {
                var a = e.separator,
                  t = e.delimiter;
                e.state.rowNum || (e.state.rowNum = 1),
                  e.state.colNum || (e.state.colNum = 1);
                var s = [],
                  o = 0,
                  n = "";
                function i() {
                  if (void 0 === e.onParseValue) s.push(n);
                  else {
                    var r = e.onParseValue(n, e.state);
                    !1 !== r && s.push(r);
                  }
                  (n = ""), (o = 0), e.state.colNum++;
                }
                if (!e.match) {
                  var l = RegExp.escape(a),
                    c = RegExp.escape(t),
                    u = /(D|S|\n|\r|[^DS\r\n]+)/.source;
                  (u = (u = u.replace(/S/g, l)).replace(/D/g, c)),
                    (e.match = new RegExp(u, "gm"));
                }
                return (
                  r.replace(e.match, function (r) {
                    switch (o) {
                      case 0:
                        if (r === a) {
                          (n += ""), i();
                          break;
                        }
                        if (r === t) {
                          o = 1;
                          break;
                        }
                        if ("\n" === r || "\r" === r) break;
                        (n += r), (o = 3);
                        break;
                      case 1:
                        if (r === t) {
                          o = 2;
                          break;
                        }
                        (n += r), (o = 1);
                        break;
                      case 2:
                        if (r === t) {
                          (n += r), (o = 1);
                          break;
                        }
                        if (r === a) {
                          i();
                          break;
                        }
                        if ("\n" === r || "\r" === r) break;
                        throw new Error(
                          "CSVDataError: Illegal State [Row:" +
                            e.state.rowNum +
                            "][Col:" +
                            e.state.colNum +
                            "]"
                        );
                      case 3:
                        if (r === a) {
                          i();
                          break;
                        }
                        if ("\n" === r || "\r" === r) break;
                        if (r === t)
                          throw new Error(
                            "CSVDataError: Illegal Quote [Row:" +
                              e.state.rowNum +
                              "][Col:" +
                              e.state.colNum +
                              "]"
                          );
                        throw new Error(
                          "CSVDataError: Illegal Data [Row:" +
                            e.state.rowNum +
                            "][Col:" +
                            e.state.colNum +
                            "]"
                        );
                      default:
                        throw new Error(
                          "CSVDataError: Unknown State [Row:" +
                            e.state.rowNum +
                            "][Col:" +
                            e.state.colNum +
                            "]"
                        );
                    }
                  }),
                  i(),
                  s
                );
              },
            },
            helpers: {
              collectPropertyNames: function (r) {
                var e = [],
                  a = [],
                  t = [];
                for (e in r)
                  for (a in r[e])
                    r[e].hasOwnProperty(a) &&
                      t.indexOf(a) < 0 &&
                      "function" != typeof r[e][a] &&
                      t.push(a);
                return t;
              },
            },
            toArray: function (e, a, t) {
              a = void 0 !== a ? a : {};
              var s = {};
              (s.callback = void 0 !== t && "function" == typeof t && t),
                (s.separator =
                  "separator" in a ? a.separator : r.csv.defaults.separator),
                (s.delimiter =
                  "delimiter" in a ? a.delimiter : r.csv.defaults.delimiter);
              var o = void 0 !== a.state ? a.state : {};
              a = {
                delimiter: s.delimiter,
                separator: s.separator,
                onParseEntry: a.onParseEntry,
                onParseValue: a.onParseValue,
                state: o,
              };
              var n = r.csv.parsers.parseEntry(e, a);
              if (!s.callback) return n;
              s.callback("", n);
            },
            toArrays: function (e, a, t) {
              a = void 0 !== a ? a : {};
              var s = {};
              (s.callback = void 0 !== t && "function" == typeof t && t),
                (s.separator =
                  "separator" in a ? a.separator : r.csv.defaults.separator),
                (s.delimiter =
                  "delimiter" in a ? a.delimiter : r.csv.defaults.delimiter);
              var o;
              if (
                (void 0 !==
                  (a = {
                    delimiter: s.delimiter,
                    separator: s.separator,
                    onPreParse: a.onPreParse,
                    onParseEntry: a.onParseEntry,
                    onParseValue: a.onParseValue,
                    onPostParse: a.onPostParse,
                    start: a.start,
                    end: a.end,
                    state: { rowNum: 1, colNum: 1 },
                  }).onPreParse && a.onPreParse(e, a.state),
                (o = r.csv.parsers.parse(e, a)),
                void 0 !== a.onPostParse && a.onPostParse(o, a.state),
                !s.callback)
              )
                return o;
              s.callback("", o);
            },
            toObjects: function (e, a, t) {
              a = void 0 !== a ? a : {};
              var s = {};
              (s.callback = void 0 !== t && "function" == typeof t && t),
                (s.separator =
                  "separator" in a ? a.separator : r.csv.defaults.separator),
                (s.delimiter =
                  "delimiter" in a ? a.delimiter : r.csv.defaults.delimiter),
                (s.headers =
                  "headers" in a ? a.headers : r.csv.defaults.headers),
                (a.start = "start" in a ? a.start : 1),
                s.headers && a.start++,
                a.end && s.headers && a.end++;
              var o,
                n = [];
              a = {
                delimiter: s.delimiter,
                separator: s.separator,
                onPreParse: a.onPreParse,
                onParseEntry: a.onParseEntry,
                onParseValue: a.onParseValue,
                onPostParse: a.onPostParse,
                start: a.start,
                end: a.end,
                state: { rowNum: 1, colNum: 1 },
                match: !1,
                transform: a.transform,
              };
              var i = {
                delimiter: s.delimiter,
                separator: s.separator,
                start: 1,
                end: 1,
                state: { rowNum: 1, colNum: 1 },
              };
              void 0 !== a.onPreParse && a.onPreParse(e, a.state);
              var l = r.csv.parsers.splitLines(e, i),
                c = r.csv.toArray(l[0], a);
              (o = r.csv.parsers.splitLines(e, a)),
                (a.state.colNum = 1),
                (a.state.rowNum = c ? 2 : 1);
              for (var u = 0, f = o.length; u < f; u++) {
                for (
                  var d = r.csv.toArray(o[u], a), m = {}, p = 0;
                  p < c.length;
                  p++
                )
                  m[c[p]] = d[p];
                void 0 !== a.transform
                  ? n.push(a.transform.call(void 0, m))
                  : n.push(m),
                  a.state.rowNum++;
              }
              if (
                (void 0 !== a.onPostParse && a.onPostParse(n, a.state),
                !s.callback)
              )
                return n;
              s.callback("", n);
            },
            fromArrays: function (e, a, t) {
              a = void 0 !== a ? a : {};
              var s = {};
              (s.callback = void 0 !== t && "function" == typeof t && t),
                (s.separator =
                  "separator" in a ? a.separator : r.csv.defaults.separator),
                (s.delimiter =
                  "delimiter" in a ? a.delimiter : r.csv.defaults.delimiter);
              var o,
                n,
                i,
                l,
                c = "";
              for (i = 0; i < e.length; i++) {
                for (o = e[i], n = [], l = 0; l < o.length; l++) {
                  var u =
                    void 0 === o[l] || null === o[l] ? "" : o[l].toString();
                  u.indexOf(s.delimiter) > -1 &&
                    (u = u.replace(
                      new RegExp(s.delimiter, "g"),
                      s.delimiter + s.delimiter
                    ));
                  var f = "\n|\r|S|D";
                  (f = (f = f.replace("S", s.separator)).replace(
                    "D",
                    s.delimiter
                  )),
                    u.search(f) > -1 && (u = s.delimiter + u + s.delimiter),
                    n.push(u);
                }
                c += n.join(s.separator) + "\r\n";
              }
              if (!s.callback) return c;
              s.callback("", c);
            },
            fromObjects: function (e, a, t) {
              a = void 0 !== a ? a : {};
              var s = {};
              if (
                ((s.callback = void 0 !== t && "function" == typeof t && t),
                (s.separator =
                  "separator" in a ? a.separator : r.csv.defaults.separator),
                (s.delimiter =
                  "delimiter" in a ? a.delimiter : r.csv.defaults.delimiter),
                (s.headers =
                  "headers" in a ? a.headers : r.csv.defaults.headers),
                (s.sortOrder = "sortOrder" in a ? a.sortOrder : "declare"),
                (s.manualOrder = "manualOrder" in a ? a.manualOrder : []),
                (s.transform = a.transform),
                "string" == typeof s.manualOrder &&
                  (s.manualOrder = r.csv.toArray(s.manualOrder, s)),
                void 0 !== s.transform)
              ) {
                var o,
                  n = e;
                for (e = [], o = 0; o < n.length; o++)
                  e.push(s.transform.call(void 0, n[o]));
              }
              var i = r.csv.helpers.collectPropertyNames(e);
              if (
                ("alpha" === s.sortOrder && i.sort(), s.manualOrder.length > 0)
              ) {
                var l = [].concat(s.manualOrder);
                for (u = 0; u < i.length; u++)
                  l.indexOf(i[u]) < 0 && l.push(i[u]);
                i = l;
              }
              var c,
                u,
                f,
                d,
                m = [];
              for (s.headers && m.push(i), c = 0; c < e.length; c++) {
                for (f = [], u = 0; u < i.length; u++)
                  (d = i[u]) in e[c] && "function" != typeof e[c][d]
                    ? f.push(e[c][d])
                    : f.push("");
                m.push(f);
              }
              return r.csv.fromArrays(m, a, s.callback);
            },
          }),
            (r.csvEntry2Array = r.csv.toArray),
            (r.csv2Array = r.csv.toArrays),
            (r.csv2Dictionary = r.csv.toObjects),
            "undefined" != typeof module &&
              module.exports &&
              (module.exports = r.csv);
        }.call(this);
    </script>

    <script>
      "use strict";

      const config = {
        printProducts: false,
        activeButton: true,
      };

      const queryParams = {
        age: {
          label: "Wiek",
          autocomplete: ["0-2 lata", "3-8 lat", "9-14 lat"],
        },
        availability: {
          label: "Dostępność",
          field: "select",
          autocomplete: ["24h"],
        },
        brand: {
          label: "Marka",
          autocomplete: [],
        },
        color: {
          label: "Kolor",
          autocomplete: [],
        },
        license: {
          label: "Licencja",
          autocomplete: [],
        },
        phrase: {
          label: "Fraza wyszukiwania",
          autocomplete: [],
        },
        sex: {
          label: "Płeć",
          autocomplete: [],
        },
        size: {
          label: "Rozmiar",
          autocomplete: [],
        },
        sortBy: {
          label: "Metoda sortowania",
          autocomplete: ["Popularity"],
        },
        sortOrder: {
          label: "Kierunek sortowania",
          autocomplete: [],
        },
        category: {
          label: "Kategoria",
          autocomplete: [],
        },
        categoriesIds: {
          label: "Wiele kategorii",
          autocomplete: [],
        },
        collection: {
          label: "Kolekcje",
          autocomplete: [],
        },
        kidType: {
          label: "Dziecko-typ",
          autocomplete: [],
        },
        producer: {
          label: "Producent",
          autocomplete: [],
        },
        serial: {
          label: "Seria",
          autocomplete: [],
        },
        productPools: {
          label: "Pula produktów",
          autocomplete: [],
        },
        price: {
          label: "Przedziały cenowe",
          autocomplete: [],
        },
        priceFrom: {
          label: "Cena od",
          autocomplete: [],
        },
        priceTo: {
          label: "Cena do",
          autocomplete: [],
        },
        bestseller: {
          label: "Bestseller",
          autocomplete: ["true"],
        },
        novelty: {
          label: "Nowość",
          autocomplete: ["true"],
        },
      };

      const reqPath = "";

      let choosenOption;

      const arrayChunkSize = 15;
      const chunkSize = 150;
      const chunkedProductLists = [];

      let indexTable = [];

      // const header = new Headers();
      // header.append('authorization', 'Basic c215a191YXQ6UFRidW02blpNOWR5QTE=');
      // header.append('mobile-authorization', 'Bearer 8zVXRTBWiBGyowXic5ansg8g9XWNY3d216733b8c174549d49172fa094001206ae7ab461689674140b76126b2cc284387143501e571254bd9a3394d313286632e');

      const form = document.getElementById("form");

      let resolveCounter = 0;
      let rejectCounter = 0;
      let totalCount = 0;
      let pageNo = 0;
      let currentPage = 0;
      const maxPage = 20;
      const totalLimit = 40;

      function getIndexesFromField() {
        const indexes = document.getElementById("query-field").value;
        return indexes;
      }

      function transformIndexesToArray(indexes) {
        const indexArray = indexes.split(",");

        return indexArray;
      }

      function randomPauseTime(min, max) {
        return Math.floor(Math.random() * (max - min + 1) + min);
      }

      function writeOnScreen(data, index, stock, sells, key) {
        stock = stock || "b.d.";
        sells = sells || "b.d.";
        index = index || data.products[0].id;
        key = key || 0;

        // console.log(data, index);

        const resultSuccess = document.querySelectorAll(
          "#results-success tbody"
        );
        const resultFailure = document.querySelectorAll("#results-failure");
        const tableElm = document.createElement("tr");
        const listElm = document.createElement("li");

        const isValid = data.products.length > 0;

        if (isValid) {
          tableElm.innerHTML = `
                    <td>${index}</td>
                    <td><a class="image-link" href="https://www.smyk.com/search?q=${
                      data.products[key].id
                    }"><img src="${data.products[key].images[3].url}"></a></td>
                    <td class="title"><a target="_blank" href="https://www.smyk.com/search?q=${
                      data.products[key].id
                    }">${data.products[key].title}</a></td>
                    <td class="current-price">${
                      data.products[key].price
                    }&nbsp;zł</td>
                    <td class="old-price">${
                      data.products[key].retailPrice === 0
                        ? data.products[key].price
                        : data.products[key].retailPrice
                    }&nbsp;zł</td>
                    <td></td>
                    <td class="orange"><strong>${stock}</strong></td>
                    <td class="green"><strong>${sells}</strong></td>
                    <td>${
                      data.filters[
                        data.filters.length - 1
                      ].values[0].name.match(/\d+/)[0] == 1
                        ? data.filters[
                            data.filters.length - 1
                          ].values[0].name.match(/\d+/)[1] + " dzień"
                        : data.filters[
                            data.filters.length - 1
                          ].values[0].name.match(/\d+/)[1] + " dni"
                    }</td>
                    <td>${data.products[key].categories[0].categoryName}</td>
                `;
          resolveCounter += 1;

          // ${ data.filters[0].key === "size" ? Object.keys(data.filters[key].values).map(function (key) { return data.filters[key].values[key].name }) : "Nie dotyczy" }

          $(".resolve-counter").text(resolveCounter);
          $(resultSuccess).append(tableElm);

          indexTable.push(data.products[key].id);
        } else {
          listElm.innerHTML = `${index + " (stock: " + stock + ")"}`;

          rejectCounter += 1;
          $(".reject-counter").text(rejectCounter);
          $(resultFailure).append(listElm);
        }

        $(".total-count").text(
          `Sprawdzono ${resolveCounter + rejectCounter} z ${totalCount}`
        );
      }

      async function makeReq(index, stock = false, sells = false) {
        if (index === "") {
          return false;
        }
        const response = await fetch(`${reqPath + index}`); // NP
        const data = await response.json();
        console.log(data);
        writeOnScreen(data, index, stock, sells);
      }

      function makeRequestQueue(indexArray) {
        totalCount = indexArray.length;
        // indexArray.forEach(makeReq);
        indexArray.forEach(function (sku) {
          makeReq(sku);
        });
      }

      function submitForm(e) {
        e.preventDefault();
        $(".radio-field").prop("disabled", true);
        $("#copy-product-ids").removeAttr("disabled");
        if (choosenOption === "custom-query") {
          makeCustomRequest(glueParams());
        } else {
          makeRequestQueue(transformIndexesToArray(getIndexesFromField()));
        }
      }

      function glueParams() {
        const allRows = $("#query-builder .single-query-row");
        let query = "";

        $(allRows).each(function (k, v) {
          const key = $(v).find("select").val();
          const value = $(v).find(".query-field").val();
          query += `${key}=${encodeURIComponent(value)}${
            k + 1 == allRows.length ? "" : "&"
          }`;
        });

        return query;
      }

      async function makeCustomRequest(query) {
        console.log(query);

        for (currentPage; currentPage <= totalLimit; ) {
          const response = await fetch(
            `${reqPath + query}&pageNo=${currentPage}`
          );
          const data = await response.json();

          pageNo = Math.ceil(data.productsCount / 36);
          currentPage++;

          console.log(data);

          totalCount = data.productsCount;

          if (totalCount > maxPage * 36 && currentPage < 2) {
            if (
              confirm(
                `To zapytanie zwróci więcej niż ${
                  maxPage * 36
                } produktów, to bardzo dużo. Jesteś pewien, że chcesz kontynuować?`
              )
            ) {
              alert(
                `Zapytanie zostanie ograniczone do ${
                  totalLimit * 36
                } produktów.`
              );
            } else {
              location.reload();
            }
          }

          $(data["products"]).each(function (k, v) {
            writeOnScreen(data, v.id, null, null, k);
            // console.log();
          });
        }

        finish();
      }

      form.addEventListener("submit", submitForm);

      function isAPIAvailable() {
        if (
          window.File &&
          window.FileReader &&
          window.FileList &&
          window.Blob
        ) {
          return true;
        } else {
          document.writeln(
            "The HTML5 APIs used in this form are only available in the following browsers:<br />"
          );
          document.writeln(" - Google Chrome: 13.0 or later<br />");
          document.writeln(" - Mozilla Firefox: 6.0 or later<br />");
          document.writeln(
            " - Internet Explorer: Not supported (partial support expected in 10.0)<br />"
          );
          document.writeln(" - Safari: Not supported<br />");
          document.writeln(" - Opera: Not supported");
          return false;
        }
      }

      function handleFileSelect(evt) {
        var files = evt.target.files; // FileList object
        var file = files[0];

        // read the file contents
        printTable(file);
      }

      function chunk(array, size) {
        totalCount = array.length;
        const chunked_arr = [];
        let index = 0;
        while (index < array.length) {
          chunked_arr.push(array.slice(index, size + index));
          index += size;
        }
        // console.log(chunked_arr);
        // console.log(chunked_arr.length * 13);
        let sendQueueIndex = 0;

        doReq(chunked_arr[sendQueueIndex]);
        setInterval(function () {
          sendQueueIndex++;
          doReq(chunked_arr[sendQueueIndex]);
        }, 5500);
      }

      function doReq(data) {
        for (var row in data) {
          makeReq(data[row][0], data[row][1], data[row][2]);
        }
      }

      function printTable(file) {
        var reader = new FileReader();
        reader.readAsText(file);
        reader.onload = function (event) {
          const csv = event.target.result;
          const data = $.csv.toArrays(csv, { separator: ";" });

          chunk(data, arrayChunkSize);
        };
      }

      function addQueryField() {
        let params = [];
        let autocomplete = [];

        for (const element in queryParams) {
          params.push(
            `<option value="${element}">${queryParams[element]["label"]}</option>`
          );
          if (queryParams[element]["autocomplete"].length > 0) {
            autocomplete.push(
              `<ul class="${element}-autocomplete autocomplete-list">`
            );
            for (const el of queryParams[element]["autocomplete"]) {
              autocomplete.push(
                `<li class="autocomplete-link" data-val="${el}">${el}</li>`
              );
            }
            autocomplete.push(`</ul>`);
          }
        }

        const html = `<div class="single-query-row"><div class="left-column"><select name="" id="">${params.join(
          " "
        )}</select></div><div class="right-column"><div class="field-autocomplete"><input type="text" class="query-field" placeholder="Wpisz wartość"><div class="autocomplete">${autocomplete.join(
          " "
        )}</div></div></div><div class="trash-column"><input type="button" class="delete-row" value="Usuń"></div></div>`;

        return html;
      }

      function finish() {
        // $('#results-success').DataTable( {
        //     dom: 'Bfrtip',
        //     ordering:  false,
        //     paging: false,
        //     buttons: [
        //         'copyHtml5',
        //         'excelHtml5',
        //     ]
        // } );

        $("#copy-product-ids").attr(
          "data-clipboard-text",
          indexTable.join(",")
        );

        var clipboard = new ClipboardJS("#copy-product-ids");
      }

      $(document).ready(function () {
        if (isAPIAvailable()) {
          $("#files").bind("change", handleFileSelect);
        }

        $(".radio-field").on("click", function () {
          const target = $(this).val();
          $(".option").hide();
          choosenOption = target;
          $(".option." + target + "").show();
        });

        $("#add-query-row").on("click", function () {
          $(addQueryField()).appendTo("#query-builder");
        });

        $("#query-builder").on("focusin", ".query-field", function () {
          const target = $(this)
            .parents(".single-query-row")
            .find("select")
            .val();
          $(this)
            .parents(".single-query-row")
            .find("." + target + "-autocomplete")
            .show();
        });

        $("#query-builder").on("mousedown", "li", function () {
          $(this)
            .parents(".single-query-row")
            .find(".query-field")
            .val($(this).attr("data-val"));
        });

        $("#query-builder").on("focusout", ".query-field", function () {
          $(".autocomplete-list").hide();
        });

        $("#query-builder").on("click", ".delete-row", function () {
          $(this).parents(".single-query-row").remove();
        });
      });
    </script>

    <p
      style="
        position: fixed;
        left: 20px;
        bottom: 0;
        color: rgba(0, 0, 0, 0.35);
        font-size: 12px;
        background: white;
        padding: 10px;
      "
    >
      Stworzony przez Marcin Rynkowski
    </p>
  </body>
</html>
